# 🎰 Bank of Taiwan｜年終尾牙抽獎系統

一個視覺化的透明球體樂透機網頁應用，採用物理模擬與程式化音效，提供公平且具有儀式感的抽獎體驗。

## ✨ 特色功能

- **透明玻璃球體**：使用 CSS 漸層與濾鏡模擬真實玻璃質感與光澤反射
- **物理引擎模擬**：真實碰撞、反彈、摩擦力與渦流混合效果
- **逐一揭曉機制**：從參與者中不重複抽取，搭配動畫與音效延遲
- **程式化音效**：使用 Web Audio API 動態生成，無需外部音檔
  - 滾球音效（Whoosh）
  - 揭曉提示音（Beep）
  - 完成樂隊（Win Arpeggio）
- **視覺特效**：彩色粒子爆裂、脈衝數字動畫、旋轉光環
- **資料持久化**：使用 LocalStorage 儲存參與者名單

## 🚀 快速開始

### 本地使用
直接用瀏覽器開啟 `index.html` 即可執行，無需安裝任何套件或伺服器。

### 操作流程
1. **上傳 CSV**：準備包含「員工編號」和「姓名」兩欄的 CSV 檔案（第一列為標題列）
2. **設定人數**：輸入要抽出的人數 N（自動限制 N ≤ 參與者總數）
3. **開始抽獎**：點擊按鈕啟動滾球動畫（約 1.6 秒）
4. **逐一揭曉**：每位中獎者依序顯示，搭配音效與特效
5. **重複抽獎**：可多次抽獎，或使用「清除資料」重新上傳名單

## 📋 CSV 檔案格式

```csv
員工編號,姓名
A001,王小明
A002,李小華
A003,張小美
```

- 第一列為標題列（會被忽略）
- 第一欄：員工編號（可為文字或數字）
- 第二欄:姓名
- 支援編碼：UTF-8、Big5、GBK、UTF-16LE（自動偵測）

## 🛠️ 技術堆疊

| 技術 | 用途 |
|------|------|
| **HTML5** | 語義化標記 |
| **CSS3** | 玻璃態設計、動畫、變數 |
| **Vanilla JavaScript** | 無框架依賴 |
| **Web Audio API** | 動態音效生成 |
| **LocalStorage** | 資料持久化 |
| **requestAnimationFrame** | 60fps 物理模擬 |

## 🎨 設計系統

### 色彩配置
- **主色（Brand）**：`#9A0036` 紅色
- **強調（Accent）**：`#D6A33A` 金色
- **輔助（Pink）**：`#EEBAC0` 粉色
- **輔助（Magenta）**：`#941C61` 紫紅

### 關鍵動畫
- `pop`：中獎者卡片彈出效果
- `spark`：粒子爆裂軌跡
- `pulse`：數字脈衝放大
- `shine`：旋轉光環

## 🎯 核心功能說明

### 物理模擬（`rollStep`）
- **渦流場**：在球體中心施加旋轉力，產生螺旋運動
- **圓形碰撞**：計算法向量並反射速度，模擬真實反彈
- **摩擦阻尼**：每幀速度衰減 0.5%，模擬空氣阻力
- **隨機擾動**：碰撞後加入微小隨機速度

### 音效系統（`SFX`）
```javascript
SFX.beep()      // 單音提示音（可調頻率、波形、音量）
SFX.whoosh()    // 滾球音效（濾波白噪音）
SFX.win()       // 完成樂隊（四音符琶音）
SFX.resumeIfNeeded()  // 啟用 AudioContext（處理瀏覽器限制）
```

### 抽獎邏輯（`runDraw`）
1. 驗證參數（N ≤ M）
2. 啟動滾球動畫 + whoosh 音效
3. 使用 Fisher-Yates Shuffle 隨機抽取
4. 逐一揭曉（間隔 550ms）：停止滾動 → 顯示號碼 → 音效 → 粒子特效 → 恢復滾動
5. 播放完成樂隊

## 📱 瀏覽器相容性

- ✅ Chrome/Edge 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ❌ IE（不支援）

## ⚠️ 注意事項

- **首次音訊啟用**：由於瀏覽器自動播放限制，需使用者手動點擊「開始抽獎」來啟用音訊
- **資料隱私**：所有資料僅儲存在瀏覽器本地，不會上傳至伺服器
- **效能優化**：使用 `will-change` 與 `transform` 實現 GPU 加速，確保 60fps 動畫
- **無障礙支援**：支援 `prefers-reduced-motion`，自動停用動畫

## 📂 專案結構

```
BotLottery/
├── index.html          # 單一檔案應用（HTML + CSS + JS）
├── logo.png            # Logo 圖片
└── README.md           # 專案說明
```

## 🔧 自訂配置

### 修改色彩
編輯 CSS `:root` 變數：
```css
:root {
  --brand: #9A0036;      /* 主色 */
  --accent: #D6A33A;     /* 強調色 */
  /* ... */
}
```

### 調整物理參數
修改 `rollStep` 函式中的常數：
```javascript
const swirl = 0.06;    // 渦流強度（預設 0.06）
const pad = 26;        // 球體邊界距離（預設 26px）
vx *= 0.995;           // 摩擦係數（預設 0.995）
```

### 調整音效
修改 `SFX.beep` 參數：
```javascript
SFX.beep({
  freq: 880,           // 頻率（Hz）
  dur: 0.08,           // 持續時間（秒）
  type: "sine",        // 波形（sine/triangle/square/sawtooth）
  gain: 0.08           // 音量（0-1）
});
```

## 📄 授權

版權所有 © Dunk

---

**Live Demo**：直接在瀏覽器開啟 `index.html`
